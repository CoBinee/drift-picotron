--[[pod_format="raw",created="2024-06-19 11:42:42",modified="2024-06-30 01:30:59",revision=564]]
-- character.lua : character
--

-- include


-- initialize sprite character
local function chinitspr()

	-- initialize vars
	app.gpage2_ = userdata('u8', 256, 512)
	do
		for y = 0, 511, 1 do
			for x = 0, 255, 1 do
				app.gpage2_:set(x, y, 0x3f)
			end
		end
	end
	
	-- data
	local data = {
        0, 0, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "000000000200002020002020002220", 
        "000000002120021212021212021112", 
        "000000002120021212211112212120", 
        "000000002120002020021212021120", 
        "000000000200000000211112022112", 
        "000000002120000000021212211120", 
        "000000000200000000002020022200", 
        30, 0, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "022000002200000200000200002000", 
        "211220021120002120002120021200", 
        "211212212212002120021200002120", 
        "021120021120000200021200002120", 
        "212112212212000000021200002120", 
        "022112021112000000002120021200", 
        "000220002220000000000200002000", 
        60, 0, 36, 7, 
        "0f200f0f0f0f0f0f", 
        "020020000000000000000000000000000000", 
        "212212000200000000000000000000000020", 
        "021120002120000000022220000000000212", 
        "211112021112000200211112000000002120", 
        "021120002120002120022220000200021200", 
        "212212000200002120000000002120212000", 
        "020020000000000200000000000200020000", 
        0, 8, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "002200000200022200022200020020", 
        "021120002120211120211120212212", 
        "212212021120022212022212212212", 
        "212212002120021120021120021112", 
        "212212002120212220022212002312", 
        "021120021112211112211120000212", 
        "002200002220022220022200000020", 
        30, 8, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "022220002200022220002200002200", 
        "211112021120211112021120021120", 
        "212220212200022212212212212212", 
        "211120211120002120021120021112", 
        "022212212212002120212212002212", 
        "211120021120002120021120021120", 
        "022200002200000200002200002200", 
        60, 8, 36, 7, 
        "0f200f0f0f0f0f0f", 
        "000000000000000020000000020000002200", 
        "000200000200002212022220212200021120", 
        "002120002120021120211112021120212212", 
        "000200000200212200022220002212022120", 
        "002120002120021120211112021120000200", 
        "000200002120002212022220212200002120", 
        "000000000200000020000000020000000200", 
        0, 16, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "002200002200022200002220022200", 
        "021120021120211120021112211120", 
        "212212212212212212212220212212", 
        "211112211112211120212000212212", 
        "211212212212212212212220212212", 
        "021120212212211120021112211120", 
        "002200020020022200002220022200", 
        30, 16, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "022220022220002220020020002220", 
        "211112211112021112212212021112", 
        "212230212220212220212212002120", 
        "211120211120212212211112002120", 
        "212220212200212212212212002120", 
        "211112212000021112212212021112", 
        "022220020000002220020020002220", 
        60, 16, 36, 7, 
        "0f200f0f0f0f0f0f", 
        "002220020020020000020020020020002200", 
        "021112212212212000212212212212021120", 
        "002120212212212000211112211212212212", 
        "002120211120212000212112212112212212", 
        "022120212212212220212112212212212212", 
        "211200212212211112212112212212021120", 
        "022000020020022220020220020020002200", 
        0, 24, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "022200002200022200002220022220", 
        "211120021120211120021112211112", 
        "212212212212212212212220022120", 
        "211120212212211120021120002120", 
        "212200212112212212022212002120", 
        "212000021112212212211120002120", 
        "020000002220020020022200000200", 
        30, 24, 30, 7, 
        "0f200f0f0f0f0f0f", 
        "020020020020020030020020020020", 
        "212212212212212212212212212212", 
        "212212212212212212021120212212", 
        "212212212212212112021120021120", 
        "212212021212021112021120002120", 
        "021120002120021212212212002120", 
        "002200000200002020020020000200", 
        60, 24, 36, 7, 
        "0f200f0f0f0f0f0f", 
        "022220002200002020002200000200000000", 
        "211112021120021212021120002120000000", 
        "022120021200021112001120021212000000", 
        "021200021200002120002120002020000000", 
        "021220021200021112002120000000022220", 
        "211112021120002120021120000000211112", 
        "022220002200000200002200000000022220", 
        0, 40, 32, 8, 
        "0f022005280f0f0f", 
        "00000000000000000000000000000070", 
        "00000000000000000000000000000747", 
        "00000000000000000000000000000747", 
        "00000000000000000000000000000744", 
        "00000000000000000000000000000747", 
        "11111111111111111111111111111747", 
        "22222222222222222222222222222272", 
        "33333333333333333333333333333333", 
        32, 40, 16, 8, 
        "0f022005280f0f0f", 
        "0000000000000000", 
        "0700000000000000", 
        "7477070000000000", 
        "4774747000000000", 
        "4747474700000000", 
        "7447414711110000", 
        "2772727222220000", 
        "3333333333330000", 
        48, 40, 16, 7, 
        "0f0400310f0f0f0f", 
        "0700000770077700", 
        "7370007337733370", 
        "7370073773737737", 
        "7370073333733370", 
        "7377773773737700", 
        "7333373773737000", 
        "0777707007070000", 
        64, 40, 32, 7, 
        "0f0400310f0f0f0f", 
        "07777770777777077777707777770000", 
        "71112117122211712221171211217000", 
        "71122117111121711112171211217000", 
        "71112117112211712221171122217000", 
        "71112117121111711112171111217000", 
        "71122217122221712221171111217000", 
        "07777770777777077777707777770000", 
        96, 40, 32, 7, 
        "0f0520310f0f0f0f", 
        "00000000000000000000000000000000", 
        "01112110122211012221101211210000", 
        "01122110111121011112101211210000", 
        "01112110112211012221101122210000", 
        "01112110121111011112101111210000", 
        "01122210122221012221101111210000", 
        "00000000000000000000000000000000", 
        0, 48, 30, 7, 
        "0f2005280f0f0f0f", 
        "000007000000000000000000000000", 
        "000071700000000000000000000000", 
        "000711700000000000000000000000", 
        "007111700000000000000000000000", 
        "071111700000000000000000000000", 
        "711111700000000000000000000000", 
        "222222222222222222222222222222", 
        30, 48, 18, 7, 
        "0f2005280f0f0f0f", 
        "000000070000000000", 
        "007770737700000000", 
        "073337333370000000", 
        "733370737700000000", 
        "077737737700000000", 
        "733370073370000000", 
        "222222222222222222", 
        48, 48, 18, 7, 
        "0f2005280f0f0f0f", 
        "000000000700000000", 
        "077700007370000000", 
        "733370077370000000", 
        "737737733370000000", 
        "737737377370000000", 
        "737737733370000000", 
        "222222222222222222", 
        66, 48, 18, 7, 
        "0f2005280f0f0f0f", 
        "000000000700000000", 
        "070770007370000000", 
        "737337077370000000", 
        "733770733370000000", 
        "737007377370000000", 
        "737000733370000000", 
        "222222222222222222", 
        84, 48, 18, 7, 
        "0f2005280f0f0f0f", 
        "007000700000000000", 
        "073777370000000000", 
        "733337377000000000", 
        "073777333700000000", 
        "073777377370000000", 
        "007337377370000000", 
        "222222222222222222", 
        0, 56, 28, 7, 
        "0f160f0f0f0f0f0f", 
        "0077707777007700077707777000", 
        "0711171111771170711171111700", 
        "7177707717717717177771777000", 
        "0711700717711117177131117000", 
        "0777170717717717177171777000", 
        "7111700717717717711171111700", 
        "0777000070070070077707777000", 
        28, 56, 36, 7, 
        "0f2d200f0f0f0f0f", 
        "077777707777770777777077777707777770", 
        "711121171222117122211712112171222217", 
        "711221171111217111121712112171211117", 
        "711121171122117122211711222171222117", 
        "711121171211117111121711112171111217", 
        "711222171222217122211711112171222117", 
        "077777707777770777777077777707777770", 
        64, 56, 32, 7, 
        "0f381016282d0f0f", 
        "00000000000000000000004444440000", 
        "01111110222222033333340000004000", 
        "01111110222222033333340000004000", 
        "05111150522225053333540000004000", 
        "05511550552255055335540000004000", 
        "05111150522225053333540000004000", 
        "00000000000000000000004444440000", 
        96, 56, 20, 7, 
        "0f280f0f0f0f0f0f", 
        "07777077707007077770", 
        "71111711171771711117", 
        "07717071771111717770", 
        "00717071771711711170", 
        "00717071771711717770", 
        "00717711171711711117", 
        "00070077707077077770", 
        128, 0, 16, 12, 
        "0f30240f0f0f0f0f", 
        "0000000000000000", 
        "0000002112000000", 
        "0000023333200000", 
        "0000122112210000", 
        "0000232112320000", 
        "0032323333232300", 
        "0021123113211200", 
        "0333331331333330", 
        "0333333333333330", 
        "0333321221233330", 
        "0333330000333330", 
        "0033300000033300", 
        144 + 1, 0, 16, 12, 
        "0f30240f0f0f0f0f", 
        "0000000000000000", 
        "0000000212220000", 
        "0000002333230000", 
        "0000022122332100", 
        "0000232122322300", 
        "0000133333221330", 
        "0001233133113333", 
        "0023331313333323", 
        "0033333333333333", 
        "0033321212333333", 
        "0033333000333333", 
        "0023330000233330", 
        160 + 2, 0, 16, 12, 
        "0f30240f0f0f0f0f", 
        "0000000000000000", 
        "0000000212220000", 
        "0000003332323100", 
        "0000021222233100", 
        "0000212223122221", 
        "0002333322213223", 
        "0012311331133233", 
        "0233133133333332", 
        "0333333333333232", 
        "0332121233333233", 
        "0233332303333332", 
        "0023320002333200", 
        176 + 3, 0, 16, 12, 
        "0f30240f0f0f0f0f", 
        "0000000000000000", 
        "0000012222100000", 
        "0000223233310000", 
        "0002133233322200", 
        "0223312211233310", 
        "0122223222322220", 
        "1233332323233321", 
        "3133333222333331", 
        "0332233333332333", 
        "0332233303332333", 
        "0333333000333330", 
        "0033330000033300", 
        192 + 4, 0, 16, 12, 
        "0f30240f0f0f0f0f", 
        "0000000000000000", 
        "0000022212000000", 
        "0000231333000000", 
        "0000312322300000", 
        "0012332221220000", 
        "0233123212213200", 
        "0333312333233200", 
        "0233333212121330", 
        "0232333332123330", 
        "0332333333333330", 
        "0233333203333320", 
        "0002332002333200", 
        208 + 5, 0, 16, 12, 
        "0f30240f0f0f0f0f", 
        "0000000000000000", 
        "0000002112000000", 
        "0000033333300000", 
        "0000123223210000", 
        "0002322112232000", 
        "0031231221321300", 
        "0021233223321200", 
        "0033212112123300", 
        "0033332112333300", 
        "0033333333333300", 
        "0033333003333300", 
        "0003330000333000", 
        16, 32, 16, 4, 
        "0f200f0f0f0f0f0f", 
        "0011010000101100", 
        "0000000000000000", 
        "0000000000000000", 
        "0000000000000000", 
        32, 32, 16, 4, 
        "0f200f0f0f0f0f0f", 
        "0010010110100100", 
        "0111101001011110", 
        "0000000000000000", 
        "0000000000000000", 
        0, 72, 24, 24, 
        "000f1a17270f0f0f", 
        "000000000000001000000000", 
        "000000111000012111100000", 
        "000011222110121222210000", 
        "000122211221222121221000", 
        "001221122112121111122100", 
        "001211221221122221012100", 
        "001101211122112122101100", 
        "000012112222212122100100", 
        "000121122212111222210000", 
        "000121021212122122221000", 
        "000010121212121212121000", 
        "000001221211112210122100", 
        "000001211111211221122100", 
        "000012211212212121011000", 
        "000012100121121011001000", 
        "000001000111111000000000", 
        "000000000134431000000000", 
        "000000000134431000000000", 
        "000000000013310000000000", 
        "000000000131131000000000", 
        "000000000134431000000000", 
        "000000000134431000000000", 
        "000000000013310000000000", 
        "000000001111111100000000", 
        28, 64, 16, 32, 
        "000516270f0f0f0f", 
        "0121001231003130", 
        "0121012003103130", 
        "0010120000311010", 
        "0120130000211130", 
        "0133013002102130", 
        "0121001321003130", 
        "0123331332223130", 
        "0123112331123130", 
        "0121001231003130", 
        "0121012003103130", 
        "0010120000311010", 
        "0120130000211130", 
        "0133013002102130", 
        "0121001321003130", 
        "0123331332223130", 
        "0123112331123130", 
        "0121001231003130", 
        "0121012003103130", 
        "0010120000311010", 
        "0120130000211130", 
        "0133013002102130", 
        "0121001321003130", 
        "0123331332223130", 
        "0123112331123130", 
        "0121001231003130", 
        "0121012003103130", 
        "0010120000311010", 
        "0120130000211130", 
        "0133013002102130", 
        "0121001321003130", 
        "0123331332223130", 
        "0123112331123130", 
        48, 76, 24, 20, 
        "0020113d2d152628", 
        "222222222222222222222222", 
        "211111111111111111111112", 
        "211777716666155551111112", 
        "211177771666615555111112", 
        "211117777166661555511112", 
        "211111777716666155551112", 
        "211111177771666615555112", 
        "211111117777166661555512", 
        "211111117777166661555512", 
        "211111177771666615555112", 
        "211111777716666155551112", 
        "211117777166661555511112", 
        "211177771666615555111112", 
        "211777716666155551111112", 
        "211111111111111111111112", 
        "222222222222222222222222", 
        "004333400000000004333400", 
        "004434400000000004434400", 
        "004333400000000004333400", 
        "444434444444444444434444", 
        0, 100, 24, 7, 
        "0f20050f0f0f0f0f", 
        "111111111111111111111111", 
        "111111111111122212222112", 
        "111111111111211111121121", 
        "111111111111122111121122", 
        "111111111111111211121121", 
        "111111111111222111121121", 
        "111111111111111111111111", 
        24, 100, 24, 7, 
        "0f20050f0f0f0f0f", 
        "111111111111111111111111", 
        "211222112222111111111111", 
        "121211211121111111111111", 
        "221222111121111111111111", 
        "121211211121111111111111", 
        "121211211121111111111111", 
        "111111111111111111111111", 
        48, 96, 32, 7, 
        "0f0301100f0f0f0f", 
        "00033333333333333333333333333000", 
        "03331113333111333311133332223330", 
        "33311111331111133111113322222333", 
        "33311111331111133111113322222333", 
        "33311111331111133111113322222333", 
        "03331113333111333311133332223330", 
        "00033333333333333333333333333000", 
        48, 104, 16, 5, 
        "0f051a0f0f0f0f0f", 
        "0111002220000000", 
        "1111122222000000", 
        "1111122222000000", 
        "1111122222000000", 
        "0111002220000000", 
        0, 128, 32, 7, 
        "0f3d000520000000", 
        "00333333111111111111111111111111", 
        "04444444422222222222222222222222", 
        "11333333111111111111111111111111", 
        "22222222222222222222222222222222", 
        "11111111111111111111111111111111", 
        "02222222222222222222222222222222", 
        "00111111111111111111111111111111", 
        32, 128, 32, 7, 
        "0f3d000520000000", 
        "11111111111111111111111133333300", 
        "22222222222222222222222444444440", 
        "11111111111111111111111133333311", 
        "22222222222222222222222222222222", 
        "11111111111111111111111111111111", 
        "22222222222222222222222222222220", 
        "11111111111111111111111111111100", 
        0, 136, 32, 7, 
        "0f17070f0f0f0f0f", 
        "00111111111111111111111111111111", 
        "02222222222222222222222222222222", 
        "11111111111111111111111111111111", 
        "22222222222222222222222222222222", 
        "11111111111111111111111111111111", 
        "02222222222222222222222222222222", 
        "00111111111111111111111111111111", 
        32, 136, 32, 7, 
        "0f17070f0f0f0f0f", 
        "11111111111111111111111111111100", 
        "22222222222222222222222222222220", 
        "11111111111111111111111111111111", 
        "22222222222222222222222222222222", 
        "11111111111111111111111111111111", 
        "22222222222222222222222222222220", 
        "11111111111111111111111111111100", 
        0, 144, 32, 7, 
        "0f200f0f0f0f0f0f", 
        "00222002200200200222022200022002", 
        "02111221122122122111211120211221", 
        "21222212212112121222212212122122", 
        "21200212212121121221211122111120", 
        "21222212212122121201212212122120", 
        "02111221122122122111212212122120", 
        "00222002200200200222020020200200", 
        32, 144, 32, 7, 
        "0f200f0f0f0f0f0f", 
        "22202002020000022002222022200220", 
        "11121221212000211221111211122111", 
        "21221221212002132122212021221221", 
        "21221221212002111120212021221221", 
        "21221221212222122120212021221221", 
        "21202112211112122120212211122112", 
        "02000220022220200200020022200220", 
        64, 144, 16, 7, 
        "0f200f0f0f0f0f0f", 
        "0200200222002000", 
        "2122122111221200", 
        "2112121222021200", 
        "2121122112021200", 
        "2122122221202000", 
        "2122121112021200", 
        "0200202220002000", 
        0, 152, 32, 7, 
        "0f200f0f0f0f0f0f", 
        "02002002200200202220002220022002", 
        "21221221122122121112021112211221", 
        "21221212212112121221212222122121", 
        "21111211112121121221221122122121", 
        "21221212212122121221222212122121", 
        "21221212212122121112211120211221", 
        "02002020020200202220022200022002", 
        32, 152, 32, 7, 
        "0f200f0f0f0f0f0f", 
        "00202222002220002200200200200000", 
        "22121111221112021122122122120000", 
        "11121222021221212212122122120000", 
        "21121112021112212212211202120000", 
        "21121222021221212212021200200000", 
        "21121111221112021120021202120000", 
        "02202222002220002200002000200000", 
        0, 160, 32, 7, 
        "0f200f0f0f0f0f0f", 
        "00222002200200202222000220020020", 
        "02111221122122121111202112212212", 
        "21222212212111121222021221212212", 
        "21221211112121121112021221212212", 
        "21221212212121121222021221221212", 
        "02111212212121121111202112002122", 
        "00222020020202202222000220000200", 
        32, 160, 16, 7, 
        "0f200f0f0f0f0f0f", 
        "2222022200000000", 
        "1111211120000000", 
        "1222212212000000", 
        "1112211120000000", 
        "1222212212000000", 
        "1111212212000000", 
        "2222020020000000", 
        0, 168, 32, 7, 
        "0f200f0f0f0f0f0f", 
        "02220002200200200222022220000000", 
        "21112021122122122111211112000000", 
        "21221212212122121222212220000000", 
        "21112211112122122112211120000000", 
        "21220212212122122221212220000000", 
        "21200212212211221112211112000000", 
        "02000020020022002220022220000000", 
        0, 176, 61, 7, 
        "0f200f0f0f0f0f0f", 
        "0222002002002220200200002220000222002002022220222200220020020", 
        "2111221221221112122120021112002111221221211112111122112212212", 
        "2122121221212222122120212221202122121221222120221221221211212", 
        "2111221221221122111120212021202111221221202120021221221212112", 
        "2122021221222212122120212221202122121221202120021221221212212", 
        "2120002112211122122120021112002111202112002120021202112212212", 
        "0200000220022200200200002220000222000220000200002000220020020", 
        -1, 
   	}
   	
   	-- set sprite
   	local i = 1
   	while data[i] ~= -1 do
   		local u = data[i + 0]
   		local v = data[i + 1]
   		local w = data[i + 2]
   		local h = data[i + 3]
   		i = i + 4
		local s = data[i]
		i = i + 1
		local col = {}
		for j = 1, 8, 1 do
			local t = (j - 1) * 2 + 1
			col[j] = app.color_[tonumber('0x' .. string.sub(s, t, t + 1)) + 1]
		end
		for y = 0, h - 1, 1 do
			local s = data[i]
			i = i + 1
			for x = 0, w - 1, 1 do
				local c = tonumber(s[x + 1])
				if c > 0 then
					app.gpage2_:set(u + x, v + y, col[c + 1])
				end
			end
		end
	end
end

-- initialize bg character
local function chinitbg()

	-- initialize vars
	app.gpage3_ = userdata('u8', 256, 512)
	do
		for y = 0, 511, 1 do
			for x = 0, 511, 1 do
				app.gpage3_:set(x, y, 0x3f)
			end
		end
	end
	
	-- data
	local data = {
        1, 0, 4, 1, 
        "0f3c22200f0f0f0f", 
        "22222222222222222222222222222222", 
        "22222222222222222222222222222222", 
        "22222222222222333322222112111332", 
        "22222222223311333333322331313311", 
        "22222222222222111121213333113122", 
        "22222222131131321132221122222221", 
        "22222222222211111313131233112132", 
        "22222222112111122211122221121222", 
        5, 0, 4, 1, 
        "0f3c22200f0f0f0f", 
        "22222222222222221111111111111111", 
        "22332133222211121111111112121221", 
        "21233112333113321111311121212112", 
        "22222221112311221311113112121211", 
        "22222222222222221111111112121211", 
        "22222222222222221111111111121111", 
        "22222222222222221131111111121111", 
        "22222222222222221111111111121111", 
        9, 0, 1, 1, 
        "0f370f0f0f0f0f0f", 
        "11111111", 
        "11111111", 
        "11111111", 
        "11111111", 
        "11111111", 
        "11111111", 
        "11111111", 
        "11111111", 
        0, 1, 2, 1, 
        "0f01200f0f0f0f0f", 
        "1111111122222222", 
        "1111111122222222", 
        "1111111122222222", 
        "1111111122222222", 
        "1111111122222222", 
        "1111111122222222", 
        "1111111122222222", 
        "1111111122222222", 
        -1, 
   	}
	
   	-- set bg
   	local i = 1
   	while data[i] ~= -1 do
   		local u = data[i + 0] * 16
   		local v = data[i + 1] * 16
   		local w = data[i + 2] * 8
   		local h = data[i + 3] * 8
   		i = i + 4
   		local s = data[i]
   		i = i + 1
		local col = {}
		for j = 1, 8, 1 do
			local t = (j - 1) * 2 + 1
			col[j] = app.color_[tonumber('0x' .. string.sub(s, t, t + 1)) + 1]
		end
		for y = 0, h - 1, 1 do
			local s = data[i]
			i = i + 1
			for x = 0, w - 1, 1 do
				local c = tonumber(s[x + 1])
				if c > 0 then
					c = col[c + 1]
					app.gpage3_:set(u + x * 2 + 0, v + y * 2 + 0, c)
					app.gpage3_:set(u + x * 2 + 1, v + y * 2 + 0, c)
					app.gpage3_:set(u + x * 2 + 0, v + y * 2 + 1, c)
					app.gpage3_:set(u + x * 2 + 1, v + y * 2 + 1, c)	
				end
			end
		end
	end
	
	-- bg to spr
	for n = 0, 255, 1 do
		local u = n % 32
		local v = n // 32
		local ud = userdata('u8', 16, 16)
		for y = 0, 15, 1 do
			for x = 0, 15, 1 do
				local c = app.gpage3_:get(u * 16 + x, v * 16 + y)
				ud:set(x, y, c)
			end
		end
		set_spr(n, ud)
	end
end

-- initialize character
function chinit()

	-- instance

	-- initialize character
	chinitspr()
	chinitbg()
	
end

--[[
'sprite-game
'  0..223:course
'224..383:object
'384..397:rival car
'398..399:my car
'400..407:navi car
'408..439:cockpit
'440..447:signal
'448..463:rank
'464..495:game clear
'496..503:game over
'509     :back ground
'510     :navi course
'511     :pause
]]
